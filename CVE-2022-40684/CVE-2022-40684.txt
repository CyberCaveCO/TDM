alert tcp any any -> any any (msg:"Detect Possible exploit Attempt Fortinet CVE-2022-40684 v1"; content:"api"; content:"/cmdb/system/admin/admin"; http_uri; content:"User-Agent|3a 20|Report Runner"; fast_pattern; content:"Forwarded|3a 20|"; content:"127.0.0.1"; http_header; content:"ssh-public-key"; http_client_body; reference:url,horizon3.ai/fortios-fortiproxy-and-fortiswitchmanager-authentication-bypass-technical-deep-dive-cve-2022-40684/; reference:cve,2022_40683; classtype:attempted-admin; sid:202210401; rev:1;)


alert tcp any any -> any any (msg:"Detect Possible exploit Attempt Fortinet CVE-2022-40684 v2"; content:"api"; content:"/cmdb/system/admin/admin"; http_uri; content:"User-Agent|3a 20|Report Runner"; fast_pattern; content:"Forwarded|3a 20|"; content:"127.0.0.1"; http_header; reference:url,horizon3.ai/fortios-fortiproxy-and-fortiswitchmanager-authentication-bypass-technical-deep-dive-cve-2022-40684/; reference:cve,2022_40683; classtype:attempted-admin; sid:202210402; rev:1;)


alert tcp any any -> any any (msg:"Detect Possible exploit Attempt Fortinet CVE-2022-40684 v3"; content:"api"; content:"/cmdb/system/admin/admin"; http_uri; content:"User-Agent|3a 20|Node.js"; fast_pattern; content:"Forwarded|3a 20|"; content:"127.0.0.1"; http_header; reference:url,horizon3.ai/fortios-fortiproxy-and-fortiswitchmanager-authentication-bypass-technical-deep-dive-cve-2022-40684/; reference:cve,2022_40683; classtype:attempted-admin; sid:202210404; rev:1;)

alert tcp [$HOME_NET,$HTTP_SERVERS] any -> $EXTERNAL_NET any (msg:"ET WEB_SERVER Successful FortiOS Auth Bypass Attempt - Config Leaked (CVE-2022-40684)"; flow:established,to_client; flowbits:isset,ET.CVE-2022-40684; file_data; content:"#config-version="; depth:16; content:"user=Local_Process_Access|0a|#conf_file_ver="; within:500; fast_pattern; content:"|0a|#buildno="; within:500; reference:url,www.horizon3.ai/fortios-fortiproxy-and-fortiswitchmanager-authentication-bypass-technical-deep-dive-cve-2022-40684/; reference:url,github.com/horizon3ai/CVE-2022-40684/blob/master/CVE-2022-40684.py; reference:cve,2022-40684; classtype:successful-admin; sid:2039485; rev:1; metadata:affected_product Web_Server_Applications, affected_product Fortigate, attack_target Web_Server, created_at 2022_10_20, cve CVE_2022_40684, deployment Perimeter, deployment SSLDecrypt, former_category WEB_SERVER, performance_impact Low, confidence High, signature_severity Major, updated_at 2022_10_20;)


alert tcp $EXTERNAL_NET any -> [$HOME_NET,$HTTP_SERVERS] $HTTP_PORTS (msg:"ET WEB_SERVER [Cluster25] FortiOS Auth Bypass Attempt (CVE-2022-40684)"; flow:established,to_server; flowbits:set,ET.CVE-2022-40684; content:"/api/v2/"; http_uri; depth:8; content:"/system/"; http_uri; distance:0; nocase; content:"Forwarded|3a 20|"; http_header; nocase; content:"for|3d 22 5b|127|2e|0|2e|0|2e|1|5d 3a|"; http_header; distance:0; nocase; fast_pattern; pcre:"/^Forwarded\x3a\x20[^\r\n]*for=\x22\x5b127\.0\.0\.1\x5d\x3a/Hmi"; content:!"Referer|3a 20|"; http_header; reference:url,www.horizon3.ai/fortios-fortiproxy-and-fortiswitchmanager-authentication-bypass-technical-deep-dive-cve-2022-40684/; reference:url,horizon3.ai/fortinet-iocs-cve-2022-40684/; reference:cve,2022-40684; classtype:attempted-admin; sid:2039173; rev:3; metadata:affected_product Web_Server_Applications, affected_product Fortigate, attack_target Web_Server, created_at 2022_10_12, deployment Perimeter, deployment SSLDecrypt, former_category WEB_SERVER, performance_impact Low, confidence High, signature_severity Major, updated_at 2022_10_20;)


