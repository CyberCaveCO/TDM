{
    "type": "monitor",
    "name": "VMware Authentication Bypass (CVE-2022-31656)",
    "enabled": true,
    "schedule": {
        "period": {
            "interval": 1,
            "unit": "MINUTES"
        }
    },
    "inputs": [
        {
            "search": {
                "indices": [
                    "filebeat-*"
                ],
                "query": {
                    "size": 1000,
                    "query": {
                        "bool": {
                            "must": [
                                {
                                    "query_string": {
                                        "query": "(http.request.method:\"POST\" AND http.cookie:HZN* AND url.original:*\\/SAAS\\/t\\/* AND url.original:*\\/auth\\/login\\/embeddedauthbroker\\/callback*)",
                                        "analyze_wildcard": true
                                    }
                                }
                            ]
                        }
                    }
                }
            }
        }
    ],
    "triggers": [
        {
            "name": "Trigger: VMware Authentication Bypass (CVE-2022-31656)",
            "severity": "5",
            "condition": {
                "script": {
                    "source": "ctx.results[0].hits.total.value &gt; 0",
                    "lang": "painless"
                }
            },
            "actions": [
                {
                    "name": "some alert",
                    "destination_id": "DESTINATION_ID",
                    "message_template": {
                        "source": "{'event.severity': '5',\n'message': 'Alert',\n'http.request.method': '{ctx.results.0.hits.hits.0._source.http.request.method}',\n'http.cookie': '{ctx.results.0.hits.hits.0._source.http.cookie}',\n'url.original': '{ctx.results.0.hits.hits.0._source.url.original}'}",
                        "lang": "mustache"
                    },
                    "throttle_enabled": false,
                    "subject_template": {
                        "source": "",
                        "lang": "mustache"
                    }
                }
            ]
        }
    ]
}