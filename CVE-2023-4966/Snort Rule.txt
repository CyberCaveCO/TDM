alert tcp any any -> any any (msg:"Possible Citrix ADC  Gateway Memory Dump Attack"; flow:to_server,established; content:"/oauth/idp/.well-known/openid-configuration"; http_uri; isdataat:24576,relative; classtype:web-application-attack; sid:1000001; rev:1;)


alert tcp $EXTERNAL_NET any -> [$HOME_NET,$HTTP_SERVERS] $HTTP_PORTS (msg:"ET EXPLOIT Citrix ADC and NetScaler Gateway Information Disclosure Attempt (CVE-2023-4966)"; flow:established,to_server; flowbits:set,ET.CVE-2023-4966.LeakAttempt; content:"/oauth/idp/.well-known/openid-configuration"; http_uri; fast_pattern; content:"Host|3a 20|"; http_header; content:!"|0d 0a|"; http_header; within:20000; reference:url,www.assetnote.io/resources/research/citrix-bleed-leaking-session-tokens-with-cve-2023-4966; reference:cve,2023-4966; classtype:attempted-admin; sid:2048930; rev:1; metadata:attack_target Web_Server, created_at 2023_10_29, cve CVE_2023_4966, deployment Perimeter, deployment SSLDecrypt, former_category EXPLOIT, performance_impact Low, confidence High, signature_severity Major, updated_at 2023_10_29, reviewed_at 2023_10_29;)

alert tcp $EXTERNAL_NET any -> [$HOME_NET,$HTTP_SERVERS] $HTTP_PORTS (msg:"ET EXPLOIT Citrix ADC and NetScaler Gateway Information Disclosure Attempt (CVE-2023-4966)"; flow:established,to_server; flowbits:set,ET.CVE-2023-4966.LeakAttempt; content:"/oauth/rp/.well-known/openid-configuration"; http_uri; fast_pattern; content:"Host|3a 20|"; http_header; content:!"|0d 0a|"; http_header; within:20000; reference:url,www.assetnote.io/resources/research/citrix-bleed-leaking-session-tokens-with-cve-2023-4966; reference:cve,2023-4966; classtype:attempted-admin; sid:2048931; rev:1; metadata:affected_product Citrix, attack_target Web_Server, created_at 2023_10_29, cve CVE_2023_4966, deployment Perimeter, deployment SSLDecrypt, former_category EXPLOIT, performance_impact Low, confidence High, signature_severity Major, updated_at 2023_10_29, reviewed_at 2023_10_29;)

alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"ET EXPLOIT Citrix ADC and NetScaler Gateway Information Disclosure - Successful Response (CVE-2023-4966)"; flow:established,to_client; flowbits:isset,ET.CVE-2023-4966.LeakAttempt; content:"200"; http_stat_code; content:"Content-Type|3a 20|application/json"; http_header; file_data; content:"|7b 22|issuer|22 3a 20 22|http"; depth:16; fast_pattern; content:!"|22 2c 20 22|authorization_endpoint"; within:20000; reference:url,www.assetnote.io/resources/research/citrix-bleed-leaking-session-tokens-with-cve-2023-4966; reference:cve,2023-4966; classtype:successful-admin; sid:2048932; rev:1; metadata:attack_target Web_Server, created_at 2023_10_29, cve CVE_2023_4966, deployment Perimeter, deployment SSLDecrypt, former_category EXPLOIT, performance_impact Low, confidence High, signature_severity Critical, updated_at 2023_10_29, reviewed_at 2023_10_29;)

